<?php
/**
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Smile Elastic Suite to newer
 * versions in the future.
 *
 *
 * @category  Smile
 * @package   Smile\ElasticsuiteCatalog
 * @author    Aurelien FOUCRET <aurelien.foucret@smile.fr>
 * @copyright 2016 Smile
 * @license   Open Software License ("OSL") v. 3.0
 */

/**
 * Template for layer navigation view
 *
 * @var $block \Smile\ElasticsuiteCatalog\Block\Navigation
 */
?>

<?php if ($block->canShowBlock()) : ?>
    <?php $filters = count($block->getFilters());?>
    <?php $activeFilters = $block->getActiveFilters(); ?>
    <?php /*$activeFilters = "[0, 1, 2]" ;*/?>
        <div class="block filter"
             id="layered-filter-block"
             data-mage-init='{"collapsible":{"openedState": "active", "collapsible": true, "active": false, "collateral": { "openedState": "filter-active", "element": "body" } }}'>
             <?php $filtered = count($block->getLayer()->getState()->getFilters()) ?>
        <div class="block-title filter-title" data-count="<?php /* @escapeNotVerified */ echo $filtered; ?>">

            <div class="block-content filter-content">
                <?php echo $block->getChildHtml('state') ?>

                <?php if ($block->getLayer()->getState()->getFilters()) : ?>
                    <div class="layered-nav__row block-actions filter-actions">
                        <h6 class="layered-nav__filter-header">Refine</h6>

                        <a href="<?php /* @escapeNotVerified */ echo $block->getClearUrl() ?>"
                           class="layered-nav__clear action clear filter-clear">
                            <span><?php /* @escapeNotVerified */ echo __('Clear All') ?></span>
                        </a>
                    </div>
                <?php endif; ?>
            </div>
        </div>

        <div class="block-content filter-content">
            <?php echo $block->getChildHtml('state') ?>

<!--            --><?php //if ($block->getLayer()->getState()->getFilters()) : ?>
<!--                <div class="block-actions filter-actions">-->
<!--                </div>-->
<!--            --><?php //endif; ?>
            <?php $wrapOptions = false; ?>
            <?php foreach ($block->getFilters() as $filter) : ?>
                <?php if ($filter instanceof \Smile\ElasticsuiteVirtualCategory\Model\Layer\Filter\Category ) continue; ?>
                <?php if ($filter->getItemsCount()) : ?>
                    <?php if (!$wrapOptions) : ?>
                        <dl class="filter-options"
                            id="narrow-by-list"
                            data-role="content"
                            data-mage-init='{"accordion":{"openedState": "active", "collapsible": true, "active": <?php  /* @noEscape */ echo $activeFilters; ?>, "multipleCollapsible": true}}'>
                            <?php $wrapOptions = true;?>
                    <?php endif; ?>

                    <dt data-role="title" class="layered-nav__title filter-options-title">
                        <?php /* @escapeNotVerified */ echo __($filter->getName()) ?>
                        <figure class="layered-nav__minus layered-nav__minus--plus">
                            <span class="layered-nav__line layered-nav__line--horizontal"></span>
                            <span class="layered-nav__line layered-nav__line--vertical"></span>
                        </figure>
                    </dt>
                    <dd data-role="collapsible" class="filter-options-item">
                        <div data-role="content" class="layered-nav__content filter-options-content" style="display:none">
                            <?php /* @escapeNotVerified */ echo $block->getChildBlock('renderer')->render($filter); ?>
                        </div>
                    </dd>
                <?php endif; ?>
            <?php endforeach; ?>
            <?php if ($wrapOptions) : ?>
                </dl>
            <?php else : ?>
                <script>
                    require([
                        'jquery'
                    ], function ($) {
                        $('#layered-filter-block').addClass('filter-no-options');
                    });
                </script>
            <?php endif; ?>
        </div>
    </div>
<?php endif; ?>

<script>
    require(['jquery'],
        function ($) {
            $( document ).ready(function() {
                $('.layered-nav__content').css( "display", "none" );
//                $('.layered-nav__title').attr("aria-selected":"true");
//                $('.layered-nav__title').attr("aria-expanded":"true");
            });
        });
</script>